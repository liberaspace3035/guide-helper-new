# テストチェックリスト

## 実装日
2024年12月

## テスト対象機能

### 1. 登録フォームの必須項目追加

#### 1.1 共通項目
- [ ] **カナ入力（必須）**
  - [ ] 姓カナが必須であることを確認
  - [ ] 名カナが必須であることを確認
  - [ ] 全角カタカナのバリデーションが機能することを確認
  - [ ] カナ未入力時にエラーメッセージが表示されることを確認

- [ ] **郵便番号（必須）**
  - [ ] 郵便番号が必須であることを確認
  - [ ] 形式（000-0000）のバリデーションが機能することを確認
  - [ ] 郵便番号未入力時にエラーメッセージが表示されることを確認

- [ ] **住所（必須）**
  - [ ] 住所が必須であることを確認
  - [ ] 住所未入力時にエラーメッセージが表示されることを確認

- [ ] **メールアドレス確認欄**
  - [ ] メールアドレス確認欄が表示されることを確認
  - [ ] メールアドレスと確認欄が一致しない場合にエラーが表示されることを確認
  - [ ] 一致する場合に登録が成功することを確認

- [ ] **電話番号（必須）**
  - [ ] 電話番号が必須であることを確認
  - [ ] 電話番号未入力時にエラーメッセージが表示されることを確認

- [ ] **性別（必須）**
  - [ ] 性別が必須であることを確認
  - [ ] 性別未選択時にエラーメッセージが表示されることを確認

- [ ] **生年月日（必須）**
  - [ ] 生年月日が必須であることを確認
  - [ ] 生年月日未入力時にエラーメッセージが表示されることを確認

#### 1.2 ユーザー（利用者）追加項目
- [ ] **面談希望日時**
  - [ ] 第1希望が必須であることを確認
  - [ ] 第2希望、第3希望が任意であることを確認
  - [ ] 日時選択が正しく動作することを確認
  - [ ] データが正しく保存されることを確認

- [ ] **応募のきっかけ**
  - [ ] 応募のきっかけが必須であることを確認
  - [ ] テキスト入力が正しく動作することを確認
  - [ ] データが正しく保存されることを確認

- [ ] **視覚障害の状況**
  - [ ] 視覚障害の状況が必須であることを確認
  - [ ] テキスト入力が正しく動作することを確認
  - [ ] データが正しく保存されることを確認

- [ ] **障害支援区分**
  - [ ] 障害支援区分が必須であることを確認
  - [ ] テキスト入力が正しく動作することを確認
  - [ ] データが正しく保存されることを確認

- [ ] **普段の生活状況**
  - [ ] 普段の生活状況が必須であることを確認
  - [ ] 案内文が表示されることを確認
  - [ ] テキスト入力が正しく動作することを確認
  - [ ] データが正しく保存されることを確認

#### 1.3 ガイド追加項目
- [ ] **応募理由**
  - [ ] 応募理由が必須であることを確認
  - [ ] テキスト入力が正しく動作することを確認
  - [ ] データが正しく保存されることを確認

- [ ] **実現したいこと**
  - [ ] 実現したいことが必須であることを確認
  - [ ] テキスト入力が正しく動作することを確認
  - [ ] データが正しく保存されることを確認

- [ ] **保有資格（最大3件）**
  - [ ] 保有資格が必須であることを確認
  - [ ] 資格名と取得年月日が必須であることを確認
  - [ ] 資格を追加できることを確認（最大3件）
  - [ ] 資格を削除できることを確認
  - [ ] データが正しく保存されることを確認（JSON形式）

- [ ] **希望勤務時間**
  - [ ] 希望勤務時間が必須であることを確認
  - [ ] テキスト入力が正しく動作することを確認
  - [ ] データが正しく保存されることを確認

### 2. 利用者の限度時間管理機能

- [ ] **データベーステーブル**
  - [ ] `user_monthly_limits`テーブルが作成されていることを確認
  - [ ] テーブル構造が正しいことを確認

- [ ] **依頼作成時の残時間チェック**
  - [ ] 限度時間が設定されている場合、残時間をチェックすることを確認
  - [ ] 残時間が不足している場合、依頼作成が拒否されることを確認
  - [ ] エラーメッセージが適切に表示されることを確認
  - [ ] 残時間が十分な場合、依頼作成が成功することを確認

- [ ] **報告書確定時の使用時間更新**
  - [ ] 報告書が承認された場合、使用時間が自動更新されることを確認
  - [ ] 使用時間が正しく計算されることを確認（分→時間変換）
  - [ ] 翌日にまたがる場合の計算が正しいことを確認

- [ ] **月次限度時間の設定（管理者）**
  - [ ] 管理者が月次限度時間を設定できることを確認（APIレベル）
  - [ ] 設定した限度時間が正しく保存されることを確認
  - [ ] 既存の限度時間が更新されることを確認

### 3. 依頼投稿の指名機能

- [ ] **ガイド一覧取得API**
  - [ ] `/api/guides/available`エンドポイントが正しく動作することを確認
  - [ ] 承認済みのガイドのみが返されることを確認
  - [ ] ガイド情報（名前、性別、年齢、自己紹介）が正しく返されることを確認

- [ ] **依頼作成フォーム**
  - [ ] 指名ガイド選択ドロップダウンが表示されることを確認
  - [ ] ガイド一覧が正しく読み込まれることを確認
  - [ ] 指名しない選択肢があることを確認
  - [ ] 指名ガイドを選択できることを確認

- [ ] **依頼保存**
  - [ ] 指名ガイドIDが正しく保存されることを確認
  - [ ] 指名しない場合、`nominated_guide_id`がNULLになることを確認
  - [ ] 指名した場合、`nominated_guide_id`が正しく保存されることを確認

### 4. データベースマイグレーション

- [ ] **usersテーブル**
  - [ ] `postal_code`カラムが追加されていることを確認
  - [ ] `email_confirmed`カラムが追加されていることを確認

- [ ] **user_profilesテーブル**
  - [ ] `interview_date_1`, `interview_date_2`, `interview_date_3`カラムが追加されていることを確認
  - [ ] `application_reason`カラムが追加されていることを確認
  - [ ] `visual_disability_status`カラムが追加されていることを確認
  - [ ] `disability_support_level`カラムが追加されていることを確認
  - [ ] `daily_life_situation`カラムが追加されていることを確認

- [ ] **guide_profilesテーブル**
  - [ ] `application_reason`カラムが追加されていることを確認
  - [ ] `goal`カラムが追加されていることを確認
  - [ ] `qualifications`カラムが追加されていることを確認
  - [ ] `preferred_work_hours`カラムが追加されていることを確認
  - [ ] 従業員番号の一意制約が追加されていることを確認

- [ ] **requestsテーブル**
  - [ ] `nominated_guide_id`カラムが追加されていることを確認
  - [ ] 外部キー制約が正しく設定されていることを確認

- [ ] **matchingsテーブル**
  - [ ] `report_completed_at`カラムが追加されていることを確認

- [ ] **新規テーブル**
  - [ ] `user_monthly_limits`テーブルが作成されていることを確認
  - [ ] `admin_operation_logs`テーブルが作成されていることを確認
  - [ ] `email_templates`テーブルが作成されていることを確認
  - [ ] `email_notification_settings`テーブルが作成されていることを確認

## テスト手順

### 1. データベースマイグレーション実行

```bash
# SQLファイルを直接実行（MySQL/MariaDBの場合）
mysql -u [username] -p [database_name] < database/migrations/add_requirements_fields.sql

# または、Laravelのマイグレーションとして実行
php artisan migrate
```

### 2. 登録フォームのテスト

1. ユーザー登録ページにアクセス
2. 各必須項目を入力せずに送信し、エラーメッセージが表示されることを確認
3. 全ての必須項目を入力して登録し、成功することを確認
4. データベースで登録データが正しく保存されていることを確認

### 3. 限度時間管理のテスト

1. 管理者としてログイン
2. ユーザーの月次限度時間を設定（API経由）
3. ユーザーとしてログイン
4. 限度時間内で依頼を作成し、成功することを確認
5. 限度時間を超える依頼を作成し、エラーが表示されることを確認
6. 報告書を作成・承認し、使用時間が更新されることを確認

### 4. 指名機能のテスト

1. ユーザーとしてログイン
2. 依頼作成ページにアクセス
3. 指名ガイド選択ドロップダウンが表示されることを確認
4. ガイドを選択して依頼を作成
5. データベースで`nominated_guide_id`が正しく保存されていることを確認

## 既知の問題

- [ ] マイグレーション実行時のエラー（Laravelのマイグレーションシステムとの互換性）
  - 解決策: SQLファイルを直接実行するか、Laravelのマイグレーションファイルに変換

## テスト結果

| テスト項目 | ステータス | 備考 |
|----------|----------|------|
| 登録フォーム必須項目 | ⏳ 未実施 | |
| 限度時間管理 | ⏳ 未実施 | |
| 指名機能 | ⏳ 未実施 | |
| データベースマイグレーション | ⏳ 未実施 | |

---

## 更新履歴

- 2024年12月: 初版作成




